// Custom behaviors for Piantor Pro BT
hml: homerow_mods_left {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&kp>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
hmr: homerow_mods_right {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&kp>;
    hold-trigger-key-positions = <0 1 2 3 4 10 11 12 13 14 20 21 22 23 24 30 31 32>;
    hold-trigger-on-release;
};
smart_shift: smart_shift_morph {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&sk LSHIFT>, <&caps_word>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
shift_layer_tap: shift_with_layer {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&mo>, <&smart_shift>;
};
shift_only_tap: shift_only {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&smart_shift>;
};

// urob's magic key: tap after letter = repeat, tap otherwise = sticky shift, hold = shift
shift_repeat: shift_repeat {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&sk LSHIFT>;
    repeat {
        trigger-keys = <Q W F P B J L U Y A R S T G M N E I O Z X C D V K H GRAVE>;
        bindings = <&key_repeat>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
};
tilde_slash_handler: tilde_to_slash {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&shift_repeat>;
    repeat {
        trigger-keys = <TILDE>;
        bindings = <&kp FSLH>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
};
magic_undo_redo: magic_undo_to_redo {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&arrow_repeat>;
    repeat {
        trigger-keys = <K_UNDO>;
        bindings = <&kp K_AGAIN>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
};
arrow_repeat: arrow_repeat_with_modifiers {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&delete_word_del>;
    repeat {
        trigger-keys = <UP DOWN LEFT RIGHT>;
        bindings = <&key_repeat>;
        max-prior-idle-ms = <5000>;
    };
};
delete_word_bspc: delete_word_after_backspace {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&tilde_slash_handler>;
    repeat {
        trigger-keys = <BSPC>;
        bindings = <&kp LC(BSPC)>;
        max-prior-idle-ms = <5000>;
    };
};
delete_word_del: delete_word_after_delete {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&delete_word_bspc>;
    repeat {
        trigger-keys = <DEL>;
        bindings = <&kp LC(DEL)>;
        max-prior-idle-ms = <5000>;
    };
};
magic_key: magic_key {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&magic_undo_redo>;
    repeat {
        trigger-keys = <K_COPY>;
        bindings = <&kp K_CUT>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
};
magic_shift_tap: magic_shift_tap {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&sk LSHIFT>, <&caps_word>;
    mods = <(MOD_LSFT)>;
};
magic_shift: magic_shift {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "tap-preferred";
    tapping-term-ms = <200>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&magic_shift_tap>;
};

// Tap-dance behaviors for dangerous actions (require double-tap)
td_bt_clr_all: tap_dance_bt_clear_all {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <300>;
    bindings = <&none>, <&bt BT_CLR_ALL>;
};
td_bt_clr: tap_dance_bt_clear {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <300>;
    bindings = <&none>, <&bt BT_CLR>;
};
td_reset: tap_dance_reset {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <300>;
    bindings = <&none>, <&sys_reset>;
};
td_boot: tap_dance_bootloader {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <300>;
    bindings = <&none>, <&bootloader>;
};

// Nav layer position A: tap=reset (double-tap only), hold=alt (matches hml timing)
nav_a_td: nav_a_tap_dance_reset {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&td_reset>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
// Nav layer position A: tap=reset, hold=alt (matches hml timing)
nav_a_hml: nav_a_homerow_left {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&sys_reset>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
space_adaptive_tap: space_adaptive_with_param {
    compatible = "zmk,behavior-macro-one-param";
    #binding-cells = <1>;
    bindings = <&space_adaptive>;
};
// Space nav layer: tap=space_adaptive (auto-caps after punctuation), hold=nav_sys layer (only triggers on right-side navigation keys)
space_nav: space_nav_layer {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&mo>, <&space_adaptive_tap>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29>;
    hold-trigger-on-release;
};
smartnum_tap: smartnum_toggle_hold {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&mo>, <&num_word>;
};
numsym_fn_morph: numsym_or_fn {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&sl 3>, <&fn_layer_noshift>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
numsym_fn_hold_morph: numsym_or_fn_hold {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&mo 3>, <&mo 2>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
numsym_tap: numsym_sticky_hold {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&numsym_fn_hold_morph>, <&numsym_fn_morph>;
};
// System layer media key home row mods
hm_media: homerow_mods_media {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&kp>;
};
// System layer function key home row mods
hm_func: homerow_mods_function {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&kp>;
};

// Custom shift behaviors for comma, period, slash
comma_morph: comma_semicolon {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp COMMA>, <&kp SEMI>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
period_morph: period_colon {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp DOT>, <&kp COLON>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
slash_morph: slash_exclamation {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp QMARK>, <&kp EXCL>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
backspace_delete_morph: backspace_or_delete {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp BSPC>, <&kp DEL>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
lpar_morph: lpar_lt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp LPAR>, <&kp LT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
rpar_morph: rpar_gt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp RPAR>, <&kp GT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
lpar_lt_morph: lpar_or_lt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp LPAR>, <&kp LT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
rpar_gt_morph: rpar_or_gt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp RPAR>, <&kp GT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
equal_no_shift: equal_without_shift {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_release &kp LSHIFT &kp RSHIFT>, <&macro_tap &kp EQUAL>;
};
plus_equal: plus_or_equal {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp PLUS>, <&equal_no_shift>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
copy_cut: copy_or_cut {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp K_COPY>, <&kp K_CUT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
undo_redo: undo_or_redo {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp K_UNDO>, <&kp K_AGAIN>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
left_right_click: left_or_right_click {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&mkp MB1>, <&mkp MB2>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
triple_backtick: triple_backtick_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp GRAVE &kp GRAVE &kp GRAVE>;
};
fn_layer_noshift: fn_layer_release_shift {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&sl 2>, <&macro_release &kp LSHIFT &kp RSHIFT>;
};
space_caps: space_and_caps_layer {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&kp SPACE>, <&sl 1>;
};
shift_exit_caps: shift_and_exit_caps {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&to 0>, <&sk LSHIFT>;
};
smartnum_to_numsym: smartnum_switch_to_numsym {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&to 0>, <&numsym_fn_morph>;
};
space_adaptive: space_or_space_caps {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&kp SPACE>;
    repeat {
        trigger-keys = <DOT QMARK EXCL>;
        bindings = <&space_caps>;
        max-prior-idle-ms = <1000>;
        strict-modifiers;
    };
};
