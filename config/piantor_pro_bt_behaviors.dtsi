// Custom behaviors for Piantor Pro BT
hml: homerow_mods_left {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&kp>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
hmr: homerow_mods_right {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&kp>;
    hold-trigger-key-positions = <0 1 2 3 4 10 11 12 13 14 20 21 22 23 24 30 31 32>;
    hold-trigger-on-release;
};
smart_shift: smart_shift_morph {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&sk LSHIFT>, <&caps_word>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
shift_layer_tap: shift_with_layer {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&mo>, <&smart_shift>;
};
shift_only_tap: shift_only {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&smart_shift>;
};

// urob's magic key: tap after letter = repeat, tap otherwise = sticky shift, hold = shift
shift_repeat: shift_repeat {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&sk LSHIFT>;
    repeat {
        trigger-keys = <Q W F P B J L U Y SQT A R S T G M N E I O Z X C D V K H COMMA DOT QMARK GRAVE>;
        bindings = <&key_repeat>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
};
magic_shift_tap: magic_shift_tap {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&shift_repeat>, <&caps_word>;
    mods = <(MOD_LSFT)>;
};
magic_shift: magic_shift {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "tap-preferred";
    tapping-term-ms = <200>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&magic_shift_tap>;
};

// Tap-dance behaviors for dangerous actions (require double-tap)
td_bt_clr_all: tap_dance_bt_clear_all {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <300>;
    bindings = <&none>, <&bt BT_CLR_ALL>;
};
td_bt_clr: tap_dance_bt_clear {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <300>;
    bindings = <&none>, <&bt BT_CLR>;
};
td_reset: tap_dance_reset {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <300>;
    bindings = <&none>, <&sys_reset>;
};
td_boot: tap_dance_bootloader {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <300>;
    bindings = <&none>, <&bootloader>;
};

// Nav layer position A: tap=reset (double-tap only), hold=alt (matches hml timing)
nav_a_td: nav_a_tap_dance_reset {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&td_reset>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
// Nav layer position A: tap=reset, hold=alt (matches hml timing)
nav_a_hml: nav_a_homerow_left {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&sys_reset>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
// Space nav layer: tap=space, hold=nav_sys layer (excludes dangerous positions)
space_nav: space_nav_layer {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&mo>, <&kp>;
    hold-trigger-key-positions = <1 2 3 4 5 6 7 8 11 12 13 14 15 16 17 18 21 22 23 24 25 26 27 28 30 31 32 33 34 35>;
    hold-trigger-on-release;
};
smartnum_tap: smartnum_toggle_hold {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&mo>, <&num_word>;
};
numsym_fn_morph: numsym_or_fn {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&sl 1>, <&fn_layer_noshift>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
numsym_fn_hold_morph: numsym_or_fn_hold {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&mo 1>, <&mo 3>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
numsym_tap: numsym_sticky_hold {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&numsym_fn_hold_morph>, <&numsym_fn_morph>;
};
// System layer media key home row mods
hm_media: homerow_mods_media {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&kp>;
};
// System layer function key home row mods
hm_func: homerow_mods_function {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&kp>;
};

// Custom shift behaviors for comma, period, slash
comma_morph: comma_semicolon {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp COMMA>, <&kp SEMI>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
period_morph: period_colon {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp DOT>, <&kp COLON>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
slash_morph: slash_exclamation {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp QMARK>, <&kp EXCL>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
lpar_morph: lpar_lt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp LPAR>, <&kp LT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
rpar_morph: rpar_gt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp RPAR>, <&kp GT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
lpar_lt_morph: lpar_or_lt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp LPAR>, <&kp LT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
rpar_gt_morph: rpar_or_gt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp RPAR>, <&kp GT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
equal_no_shift: equal_without_shift {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_release &kp LSHIFT &kp RSHIFT>, <&macro_tap &kp EQUAL>;
};
plus_equal: plus_or_equal {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp PLUS>, <&equal_no_shift>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
copy_cut: copy_or_cut {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp K_COPY>, <&kp K_CUT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
undo_redo: undo_or_redo {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp K_UNDO>, <&kp K_AGAIN>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
left_right_click: left_or_right_click {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&mkp MB1>, <&mkp MB2>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
triple_backtick: triple_backtick_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp GRAVE &kp GRAVE &kp GRAVE>;
};
middle_click_exit: middle_click_and_exit {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&mkp MB3>, <&to 0>;
};
fn_layer_noshift: fn_layer_release_shift {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&sl 3>, <&macro_release &kp LSHIFT &kp RSHIFT>;
};
