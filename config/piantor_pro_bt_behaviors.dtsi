// Custom behaviors for Piantor Pro BT
hml: homerow_mods_left {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&kp>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
hmr: homerow_mods_right {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&kp>;
    hold-trigger-key-positions = <0 1 2 3 4 10 11 12 13 14 20 21 22 23 24 30 31 32>;
    hold-trigger-on-release;
};
smart_shift: smart_shift_morph {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&sk LSHIFT>, <&caps_word>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
shift_layer_tap: shift_with_layer {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&mo>, <&smart_shift>;
};
shift_only_tap: shift_only {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&smart_shift>;
};

// urob's magic key: tap after special keys = special action, otherwise = repeat
// Flat structure with all triggers as child nodes (no chaining to prevent stack overflow)
magic_key_repeat: magic_key_repeat_fallback {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&key_repeat>;

    t_i_shift {
        trigger-keys = <I>;
        bindings = <&emit_backspace_shift_f10>;
        max-prior-idle-ms = <5000>;
    };
    t_t_shift {
        trigger-keys = <T>;
        bindings = <&emit_backspace_shift_f12>;
        max-prior-idle-ms = <5000>;
    };
    t_a_shift {
        trigger-keys = <A>;
        bindings = <&emit_backspace_shift_f8>;
        max-prior-idle-ms = <5000>;
    };
    t_n_shift {
        trigger-keys = <N>;
        bindings = <&emit_backspace_shift_f11>;
        max-prior-idle-ms = <5000>;
    };
};
magic_key: magic_key {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&magic_key_repeat>;

    t_copy {
        trigger-keys = <K_COPY>;
        bindings = <&kp K_CUT>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_undo {
        trigger-keys = <K_UNDO>;
        bindings = <&kp K_AGAIN>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_del {
        trigger-keys = <DEL>;
        bindings = <&kp LC(DEL)>;
        max-prior-idle-ms = <5000>;
    };
    t_bspc {
        trigger-keys = <BSPC>;
        bindings = <&kp LC(BSPC)>;
        max-prior-idle-ms = <5000>;
    };
    t_backtick {
        trigger-keys = <GRAVE>;
        bindings = <&backtick_code_block>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_tilde {
        trigger-keys = <TILDE>;
        bindings = <&kp FSLH>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_p {
        trigger-keys = <P>;
        bindings = <&kp H>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_h {
        trigger-keys = <H>;
        bindings = <&kp Y>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_y {
        trigger-keys = <Y>;
        bindings = <&kp P>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_c {
        trigger-keys = <C>;
        bindings = <&kp S>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_w {
        trigger-keys = <W>;
        bindings = <&kp S>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_g {
        trigger-keys = <G>;
        bindings = <&kp S>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_e {
        trigger-keys = <E>;
        bindings = <&kp U>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_u {
        trigger-keys = <U>;
        bindings = <&kp E>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_o {
        trigger-keys = <O>;
        bindings = <&kp A>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_r {
        trigger-keys = <R>;
        bindings = <&kp L>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_a {
        trigger-keys = <A>;
        bindings = <&emit_backspace_f8>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_n {
        trigger-keys = <N>;
        bindings = <&emit_backspace_f11>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_s {
        trigger-keys = <S>;
        bindings = <&kp C>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_l {
        trigger-keys = <L>;
        bindings = <&kp R>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_paste {
        trigger-keys = <K_PASTE>;
        bindings = <&paste_code_block>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_space {
        trigger-keys = <SPACE>;
        bindings = <&emit_tilde_slash>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_dot {
        trigger-keys = <DOT>;
        bindings = <&emit_dot_slash>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_colon {
        trigger-keys = <COLON>;
        bindings = <&colon_code_block>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_i {
        trigger-keys = <I>;
        bindings = <&emit_backspace_f10>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_t {
        trigger-keys = <T>;
        bindings = <&emit_backspace_f12>;
        max-prior-idle-ms = <5000>;
        strict-modifiers;
    };
    t_f7 {
        trigger-keys = <F7>;
        bindings = <&emit_backspace_f9>;
        max-prior-idle-ms = <5000>;
    };
    t_f8 {
        trigger-keys = <F8>;
        bindings = <&emit_backspace_shift_f9>;
        max-prior-idle-ms = <5000>;
    };
};
magic_key_morph: magic_key_or_fn {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&magic_key>, <&fn_layer_noshift>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
magic_shift_tap: magic_shift_tap {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&sk LSHIFT>, <&caps_word>;
    mods = <(MOD_LSFT)>;
};
magic_shift: magic_shift {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "tap-preferred";
    tapping-term-ms = <200>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&magic_shift_tap>;
};

// Tap-dance behaviors for dangerous actions (require double-tap)
td_bt_clr_all: tap_dance_bt_clear_all {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <1000>;
    bindings = <&none>, <&bt BT_CLR_ALL>;
};
td_bt_clr: tap_dance_bt_clear {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <1000>;
    bindings = <&none>, <&bt BT_CLR>;
};
td_reset: tap_dance_reset {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <1000>;
    bindings = <&none>, <&sys_reset>;
};
td_boot: tap_dance_bootloader {
    compatible = "zmk,behavior-tap-dance";
    #binding-cells = <0>;
    tapping-term-ms = <1000>;
    bindings = <&none>, <&bootloader>;
};

// Nav layer position A: tap=boot (double-tap only), hold=alt (matches hml timing)
nav_a_td: nav_a_tap_dance_boot {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&td_boot>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
// Nav layer position A: tap=reset, hold=alt (matches hml timing)
nav_a_hml: nav_a_homerow_left {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&kp>, <&sys_reset>;
    hold-trigger-key-positions = <5 6 7 8 9 15 16 17 18 19 25 26 27 28 29 33 34 35>;
    hold-trigger-on-release;
};
space_adaptive_tap: space_adaptive_with_param {
    compatible = "zmk,behavior-macro-one-param";
    #binding-cells = <1>;
    bindings = <&space_adaptive>;
};
// Space nav layer: tap=space_adaptive (auto-caps after punctuation), hold=nav_sys layer (only triggers on left-side keys)
space_nav: space_nav_layer {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    require-prior-idle-ms = <150>;
    tapping-term-ms = <280>;
    quick-tap-ms = <175>;
    bindings = <&mo>, <&space_adaptive_tap>;
    hold-trigger-key-positions = <0 1 2 3 4 10 11 12 13 14 20 21 22 23 24 30 31 32>;
    hold-trigger-on-release;
};
numsym_fn_morph: numsym_or_fn {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&sl 3>, <&fn_layer_noshift>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
numsym_fn_hold_morph: numsym_or_fn_hold {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&mo 3>, <&mo 2>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
numsym_tap: numsym_sticky_hold {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&numsym_fn_hold_morph>, <&numsym_fn_morph>;
};
// System layer media key home row mods
hm_media: homerow_mods_media {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&kp>;
};
// System layer function key home row mods
hm_func: homerow_mods_function {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&kp>, <&kp>;
};

// Custom shift behaviors for slash
slash_morph: slash_exclamation {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp QMARK>, <&kp EXCL>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
backspace_delete_morph: backspace_or_delete {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp BSPC>, <&kp DEL>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
lpar_morph: lpar_lt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp LPAR>, <&kp LT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
rpar_morph: rpar_gt {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp RPAR>, <&kp GT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
equal_no_shift: equal_without_shift {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_release &kp LSHIFT &kp RSHIFT>, <&macro_tap &kp EQUAL>;
};
plus_equal: plus_or_equal {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp PLUS>, <&equal_no_shift>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
copy_cut: copy_or_cut {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp K_COPY>, <&kp K_CUT>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
undo_redo: undo_or_redo {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&kp K_UNDO>, <&kp K_AGAIN>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
left_right_click: left_or_right_click {
    compatible = "zmk,behavior-mod-morph";
    #binding-cells = <0>;
    bindings = <&mkp MB1>, <&mkp MB2>;
    mods = <(MOD_LSFT|MOD_RSFT)>;
};
triple_backtick: triple_backtick_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp GRAVE &kp GRAVE &kp GRAVE>;
};
backtick_code_block: backtick_code_block_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp GRAVE &kp GRAVE &kp LS(RET)>;
};
paste_code_block: paste_code_block_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp LS(RET) &kp GRAVE &kp GRAVE &kp GRAVE &kp LS(RET)>;
};
colon_code_block: colon_code_block_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp LS(RET) &kp GRAVE &kp GRAVE &kp GRAVE &kp LS(RET)>;
};
emit_the: emit_the_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp T &kp H &kp E>;
};
emit_dot_slash: emit_dot_slash_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp FSLH>;
};
emit_tilde_slash: emit_tilde_slash_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp TILDE &kp FSLH>;
};
// Romanian diacritics via RightSuper+F7-F12
// RightSuper+F7 = ă, RightSuper+F8 = Ă, RightSuper+F9 = â/Â, RightSuper+F10 = î/Î, RightSuper+F11 = ș/Ș, RightSuper+F12 = ț/Ț
emit_backspace_f8: emit_backspace_f8_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp RG(F7)>;
};
emit_backspace_shift_f8: emit_backspace_shift_f8_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp RG(F8)>;
};
emit_backspace_f9: emit_backspace_f9_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp RG(F9)>;
};
emit_backspace_shift_f9: emit_backspace_shift_f9_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp LS(RG(F9))>;
};
emit_backspace_f10: emit_backspace_f10_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp RG(F10)>;
};
emit_backspace_shift_f10: emit_backspace_shift_f10_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp LS(RG(F10))>;
};
emit_backspace_f11: emit_backspace_f11_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp RG(F11)>;
};
emit_backspace_shift_f11: emit_backspace_shift_f11_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp LS(RG(F11))>;
};
emit_backspace_f12: emit_backspace_f12_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp RG(F12)>;
};
emit_backspace_shift_f12: emit_backspace_shift_f12_macro {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&macro_tap &kp BSPC &kp LS(RG(F12))>;
};
fn_layer_noshift: fn_layer_release_shift {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&sl 2>, <&macro_release &kp LSHIFT &kp RSHIFT>;
};
smartnum_tap: smartnum_toggle_hold {
    compatible = "zmk,behavior-hold-tap";
    #binding-cells = <2>;
    flavor = "balanced";
    tapping-term-ms = <280>;
    quick-tap-ms = <225>;
    bindings = <&mo>, <&num_word>;
};
space_caps: space_and_caps_layer {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    tap-ms = <0>;
    wait-ms = <0>;
    bindings = <&kp SPACE>, <&sl 1>;
};
shift_exit_caps: shift_and_exit_caps {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&to 0>, <&sk LSHIFT>;
};
smartnum_to_numsym: smartnum_switch_to_numsym {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&to 0>, <&numsym_fn_morph>;
};
esc_to_default: esc_and_exit_to_default {
    compatible = "zmk,behavior-macro";
    #binding-cells = <0>;
    bindings = <&kp ESC>, <&to 0>;
};
space_adaptive: space_or_space_caps {
    compatible = "zmk,behavior-adaptive-key";
    #binding-cells = <0>;
    bindings = <&kp SPACE>;
    repeat {
        trigger-keys = <DOT QMARK EXCL>;
        bindings = <&space_caps>;
        max-prior-idle-ms = <1000>;
        strict-modifiers;
    };
};
